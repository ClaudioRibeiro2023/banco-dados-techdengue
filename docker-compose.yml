services:
  techdengue-dashboard:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_BASE_URL=https://api.sistematechdengue.com/api/v1
        - NEXT_PUBLIC_API_ACCESS_TOKEN=${NEXT_PUBLIC_API_ACCESS_TOKEN}
        - NEXT_PUBLIC_API_SERVICE_EMAIL=${NEXT_PUBLIC_API_SERVICE_EMAIL}
        - NEXT_PUBLIC_API_SERVICE_PASSWORD=${NEXT_PUBLIC_API_SERVICE_PASSWORD}
    container_name: techdengue-dashboard
    ports:
      - "2000:3000"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      # ===== API TECHDENGUE (Backend) =====
      - NEXT_PUBLIC_API_BASE_URL=https://api.sistematechdengue.com/api/v1
      - NEXT_PUBLIC_API_TIMEOUT=30000
      - NEXT_PUBLIC_API_RETRY_ATTEMPTS=3
      - NEXT_PUBLIC_API_ACCESS_TOKEN=${NEXT_PUBLIC_API_ACCESS_TOKEN}
      # ===== MAPBOX =====
      - NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN=pk.eyJ1IjoiYWVyb2Nsb3VkIiwiYSI6ImNtaWVvZzVqeTA1aXozZXBzMXNxZWo0ZnEifQ.KwMXCX8GBnQKaTaea2CWkA
      - NEXT_PUBLIC_MAPBOX_STYLE=mapbox://styles/mapbox/light-v11
      - NEXT_PUBLIC_MAPBOX_DEFAULT_ZOOM=5
      - NEXT_PUBLIC_MAPBOX_DEFAULT_CENTER_LAT=-16.6869
      - NEXT_PUBLIC_MAPBOX_DEFAULT_CENTER_LNG=-49.2646
      # ===== OPENWEATHER =====
      - NEXT_PUBLIC_OPENWEATHER_API_KEY=0d993e8b059135c9548085a50ff48f68
      - NEXT_PUBLIC_OPENWEATHER_BASE_URL=https://api.openweathermap.org/data/2.5
      - NEXT_PUBLIC_OPENWEATHER_UNITS=metric
      # ===== IBGE & INFODENGUE =====
      - NEXT_PUBLIC_IBGE_API_URL=https://servicodados.ibge.gov.br/api
      - NEXT_PUBLIC_IBGE_LOCALIDADES_URL=https://servicodados.ibge.gov.br/api/v1/localidades
      - NEXT_PUBLIC_INFODENGUE_API_URL=https://info.dengue.mat.br/api
      # ===== ANALYTICS =====
      - NEXT_PUBLIC_SENTRY_DSN=https://401ae6d084e41e4a8e9f0fd3d71710cc@o4510502722142208.ingest.us.sentry.io/4510502738460672
      - NEXT_PUBLIC_POSTHOG_KEY=phc_dWOtEa6gskrHxGRhVjzAxnqymigaEDpxwVBVcTAnWLY
      - NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com
      - NEXT_PUBLIC_GA_MEASUREMENT_ID=G-YYSPNFMHSW
      # ===== APP CONFIG =====
      - NEXT_PUBLIC_APP_NAME=TechDengue Dashboard
      - NEXT_PUBLIC_APP_VERSION=1.0.0
      - NEXT_PUBLIC_APP_ENV=production
      # ===== FEATURE FLAGS =====
      - NEXT_PUBLIC_ENABLE_DARK_MODE=true
      - NEXT_PUBLIC_ENABLE_WEATHER_CORRELATION=true
      - NEXT_PUBLIC_ENABLE_PREDICTIVE_ANALYTICS=false
      - NEXT_PUBLIC_ENABLE_EXPORT_PDF=true
      - NEXT_PUBLIC_ENABLE_EXPORT_EXCEL=true
      # ===== DEBUG =====
      - NEXT_PUBLIC_MOCK_API=false
      - NEXT_PUBLIC_DEBUG_MODE=false
      - NEXT_PUBLIC_LOG_LEVEL=warn
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: techdengue-network
